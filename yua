#!/bin/bash

blue='\e[0;34m'
red='\e[0;31m'
NC='\e[0m'

CMD='pacman'
if [ -f /usr/bin/paru ]; then
    CMD='paru'
elif [ -f /usr/bin/yay ]; then
    CMD='yay'
else
    CMD='pacman'
fi

if [ "$HOSTNAME" = "ginger" ] && grep " / " /proc/mounts | grep -q "subvol=/root "; then
    $CMD -Syu

    #echo
    #echo -e "${blue}>>${NC} Updating Trapped ${blue}<<${NC}"
    #sudo cp -r /var/lib/pacman/sync/ /mnt/btrfs/trapped/var/lib/pacman/
    #grep -q "/mnt/btrfs/trapped/boot" /proc/mounts || \
    #    sudo mount /dev/disk/by-label/trappedEFI /mnt/btrfs/trapped/boot
    #sudo systemd-nspawn -q \
    #    -D /mnt/btrfs/trapped \
    #    --resolv-conf=bind-host \
    #    --bind /home \
    #    --bind /var/cache/pacman/pkg \
    #    -u mitch \
    #    /home/mitch/.bin/zfs-yu
    #sudo umount /mnt/btrfs/trapped/boot

    echo
    echo -e "${blue}>>${NC} Updating CHROOT ${blue}<<${NC}"
    sudo cp -r /var/lib/pacman/sync/ "$CHROOT"/root/var/lib/pacman/
    sudo arch-nspawn "$CHROOT"/root pacman -Syu
else
    $CMD -Syu
fi
